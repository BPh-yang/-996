# 8.7

1. å­—èŠ‚è½¬æ¢å·¥å…·ï¼Œå‰å‡ å¤©å‘çš„æ˜¯jsç‰ˆçš„ä»Šå¤©æ‰¾åˆ°ä¸€ä¸ªjavaç‰ˆæœ¬çš„

```
/*
* è·å–æ–‡ä»¶å­—èŠ‚å¤§å°è½¬æ¢æˆ kbã€Mã€G ç­‰å•å…ƒ å·¥å…·ç±»
*
* */
public class readableFileSize {

Â Â Â Â public static String readableFileSize(long size) {
Â Â Â Â Â Â Â Â if (size <= 0) return "0";
Â Â Â Â Â Â Â Â final String[] units = new String[]{"B", "KB", "MB", "GB", "TB"};
Â Â Â Â Â Â Â Â int digitGroups = (int) (Math.log10(size) / Math.log10(1024));
Â Â Â Â Â Â Â Â return new DecimalFormat("#,##0.#").format(size / Math.pow(1024, digitGroups)) + " " + units[digitGroups];
Â Â Â Â }

}
```

Â  Â  Â  Â 2.ç›´æ¥åœ¨sqlè¯­å¥ä¸Šè¿›è¡Œé€»è¾‘åˆ¤æ–­ ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥æŠŠç»“æœæ”¾è¿›ç»“æœé›†

ç°åœ¨æœ‰è¿™ä¹ˆä¸¤ä¸ªè¡¨ï¼Œä¸€ä¸ªfileè¡¨å­˜çš„æ˜¯æ–‡ä»¶åå­—ï¼Œåˆ›å»ºè¯¥æ–‡ä»¶äººå‘˜çš„å§“åï¼Œå¤§å°ï¼Œç±»å‹ï¼Œ fileName å¯¹åº”ç€ user è¡¨çš„ id

![4ce17b1b6fbfb438617ca0bacd1d6931.png](image/4ce17b1b6fbfb438617ca0bacd1d6931.png)

ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªè¦æ±‚ï¼Œå°±æ˜¯æŠŠfileè¡¨å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥ æŒ‰ä»¥å‰çš„å†™æ³•

```
SELECT
Â Â Â Â f.fileName,
Â Â Â Â u.NAME,
Â Â Â Â f.size,
Â Â Â Â f.type
FROM
Â Â Â Â file f,
Â Â Â Â USER u
WHERE
Â Â Â Â u.id = f.createName
```

æ•ˆæœå›¾

![06d351a7612a5b6af559e6cd4d683b9d.png](image/06d351a7612a5b6af559e6cd4d683b9d.png)

æ–°å­¦çš„ä¸€ç§å†™æ³•ï¼Œç±»ä¼¼äºæŠŠ user è¡¨é‡Œçš„ name æŸ¥å‡ºæ¥ç„¶åç»™ä»–å–ä¸ªåˆ«å createName

```
SELECT
Â Â Â Â fileName,
Â Â Â Â (select u.`name` from user u where u.id=f.createName) as createName,
Â Â Â Â size,
Â Â Â Â type
FROM
Â Â Â Â file f
WHERE
Â Â Â Â 1 = 1
```

è™½ç„¶èƒ½æŸ¥å‡ºæ¥ä½†æ˜¯æ•ˆæœä¸è¦æ±‚ä¸ç¬¦ï¼Œå¦‚ size å¤§å°æ²¡æœ‰è½¬æ¢å•ä½ç°åœ¨è¿˜æ˜¯å­—èŠ‚ï¼Œtype ç±»å‹ç°åœ¨æ²¡æœ‰æŸ¥è¯¢å‡ºæ¥ï¼Œå…¶å®å¯ä»¥åœ¨å­˜è¿›å»å‰æˆ–è€…æŸ¥å‡ºæ¥åç»™ä»–è¿›è¡Œè½¬æ¢è·Ÿå®Œå–„ï¼Œä½†æ˜¯æˆ‘ä»¬å½“æ—¶æ¥æ”¶SQLæŸ¥è¯¢ç»“æœçš„æ˜¯ ResultSet ç»“æœé›†ï¼Œæå–å‡ºæ¥å°±å­˜ä¸è¿›å»äº†ï¼Œæ‰€ä»¥åªèƒ½åœ¨ SQL è¯­å¥ä¸­ç»™ä»–è¿›è¡Œè½¬æ¢

é¦–å…ˆè½¬æ¢ sizeï¼ˆå¤§å°ï¼‰

```
1000b = 1024kbÂ Â 
1024kb = 1mbÂ Â 
1024 mb = 1gb
```

è¿™æ—¶å€™å°±éœ€è¦ç±»ä¼¼äº if else çš„sqlè¯­å¥

![df41822bcd9037298adea29e14d3da00.png](image/df41822bcd9037298adea29e14d3da00.png)

ç½‘å€ï¼š[https://blog.csdn.net/qq\_36850813/article/details/80449860](https://blog.csdn.net/qq_36850813/article/details/80449860)

æŠŠåŸæ¥SQLè¯­å¥æ”¹è¿›ä¸€ä¸‹

```
SELECT
Â Â Â Â fileName,
Â Â Â Â ( SELECT u.`name` FROM USER u WHERE u.id = f.createName ) AS createName,
Â Â Â Â ( SELECT CASE WHEN size < 1048576 THEN size / 1024Â 
Â Â  Â Â Â  Â Â Â  Â Â Â  Â Â Â WHEN size > 1048576 AND size < 1073741824 THEN size / 1048576 END ) size,
Â Â Â Â type
FROM
Â Â Â Â file f
WHERE
Â Â Â Â 1 = 1
```

æ•ˆæœå›¾

![d6b669cf2babb07384b3de511534481f.png](image/d6b669cf2babb07384b3de511534481f.png)

ç°åœ¨å¤§å°å·²ç»æ¢ç®—å‡ºæ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰å•ä½è¿˜éœ€è¦çœç•¥å°æ•°ç‚¹åä¸¤ä½å°æ•°ï¼Œå†åŠ ä¸Šå•ä½ï¼Œ

è¿™æ—¶å€™éœ€è¦ä¸€ä¸ª concatï¼ˆï¼‰ å‡½æ•°Â  Â  ç½‘å€ï¼š[https://www.cnblogs.com/apolloren/p/11002449.html](https://www.cnblogs.com/apolloren/p/11002449.html)

çœç•¥å°æ•°ç‚¹åå‡ ä½å°æ•°Â  castï¼ˆï¼‰å‡½æ•°Â Â Â  Â  ç½‘å€ï¼š[https://blog.csdn.net/zhaoshuliok/article/details/54925147](https://blog.csdn.net/zhaoshuliok/article/details/54925147)

å†æŠŠsqlè¯­å¥æ”¹è¿›ä¸€ä¸‹

```
SELECT
Â Â Â Â fileName,
Â Â Â Â ( SELECT u.`name` FROM USER u WHERE u.id = f.createName ) AS createName,
Â Â Â Â ( SELECT CASE WHEN size < 1048576 THEN CONCAT ( CAST( size / 1024 AS DECIMAL ( 38, 2 )), 'KB' )
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â WHEN size > 1048576 AND size < 1073741824 then CONCAT( CAST( size / 1048576 AS DECIMAL ( 38, 2 )), 'MB' )Â Â END ) size,
Â Â Â Â type
FROM
Â Â Â Â file f
WHERE
Â Â Â Â 1 = 1
```

æ•ˆæœå›¾

![9ab8c059109c3119afeca193f454fbaa.png](image/9ab8c059109c3119afeca193f454fbaa.png)

è¿™æ—¶å€™è¿˜å‰©ä¸€ä¸ª tyoeï¼ˆç±»å‹ï¼‰ï¼Œæ€è·¯æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²æˆªå–åç¼€åÂ 

å‡½æ•°ï¼š **SUBSTRING\_INDEX\(str,delim,count\)Â  Â** ç½‘å€ï¼š**[https://blog.csdn.net/kk123k/article/details/81015587](https://blog.csdn.net/kk123k/article/details/81015587)**

ä¿®æ”¹ä¸€ä¸‹SQL è¯­å¥

```
SELECT
Â Â Â Â fileName,
Â Â Â Â ( SELECT u.`name` FROM USER u WHERE u.id = f.createName ) AS createName,
Â Â Â Â ( SELECT CASE WHEN size < 1048576 THEN CONCAT ( CAST( size / 1024 AS DECIMAL ( 38, 2 )), 'KB' )
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â WHEN size > 1048576 AND size < 1073741824 then CONCAT( CAST( size / 1048576 AS DECIMAL ( 38, 2 )), 'MB' )Â Â END ) size,
Â Â Â Â (SELECT SUBSTRING_INDEX( fileName, '.', - 1 ))Â Â Â Â type
FROM
Â Â Â Â file f
WHERE
Â Â Â Â 1 = 1
```

æ•ˆæœå›¾

![62cd8a2b4a0291e83378dcd76f11369d.png](image/62cd8a2b4a0291e83378dcd76f11369d.png)

éœ€æ±‚å®Œæˆï¼
